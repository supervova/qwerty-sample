function bootpopup(options){this.formid="bootpopup-form"+String(Math.random()).substr(2);var opts={title:document.title,showclose:true,content:[],buttons:["close"],dismiss:function(data){},close:function(data){},ok:function(data){},cancel:function(data){},yes:function(data){},no:function(data){},complete:function(data){},}
var buttons=[];for(key in options){if(key in opts)opts[key]=options[key];if(["close","ok","cancel","yes","no"].indexOf(key)>=0)buttons.push(key);}if(buttons.length>0){if(!("buttons"in options))opts.buttons=[];buttons.forEach(function(item){if(opts.buttons.indexOf(item)<0)opts.buttons.push(item);});}var modalWindow=$('<div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="bootpopup-title"></div>');var dialog=$('<div class="modal-dialog" role="document"></div>');var content=$('<div class="modal-content"></div>');dialog.append(content);modalWindow.append(dialog);var header=$('<div class="modal-header"></div>');if(opts.showclose)header.append('<button type="button" class="bootpopup-button close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>');header.append('<h4 class="modal-title" id="bootpopup-title">'+opts.title+'</h4>');content.append(header);var body=$('<div class="modal-body"></div>').appendTo(content);var form=$("<form></form>",{id:this.formid,class:"form-horizontal",onsubmit:"return false;"}).appendTo(body);for(var i in opts.content){var entry=opts.content[i];switch(typeof entry){case"string":form.append(entry);break;case"object":for(var type in entry){var attrs=entry[type];for(var attribute in attrs)if(typeof attrs[attribute]==="function")attrs[attribute]="("+attrs[attribute]+")(this)";switch(type){case"button":case"text":case"submit":case"color":case"url":case"password":case"hidden":case"file":case"number":case"email":case"reset":case"date":attrs.type=type;case"input":attrs.id=(typeof attrs.id==="undefined"?"bootpopup-input"+String(Math.random()).substr(2):attrs.id);attrs.class=(typeof attrs.class==="undefined"?"form-control":attrs.class);attrs.type=(typeof attrs.type==="undefined"?"text":attrs.type);var formGroup=$('<div class="form-group"></div>').appendTo(form);$("<label></label>",{for:attrs.id,class:"col-sm-2 control-label",text:attrs.label}).appendTo(formGroup);delete attrs.label;var divColSm=$('<div class="col-sm-10"></div>').appendTo(formGroup);$("<input />",attrs).appendTo(divColSm);break;default:form.append($("<"+type+"></"+type+">",attrs));}}break;default:throw"Invalid entry type";}}var footer=$('<div class="modal-footer"></div>');content.append(footer);for(key in opts.buttons){var item=opts.buttons[key];var btnClass="";var btnText="";switch(item){case"close":btnClass="btn-primary";btnText=js_translate("Close.");break;case"ok":btnClass="btn-primary";btnText=js_translate("OK");break;case"cancel":btnClass="btn-default";btnText=js_translate("Cancel");break;case"yes":btnClass="btn-primary";btnText=js_translate("Yes");break;case"no":btnClass="btn-default";btnText=js_translate("No");break;}$("<button></button>",{type:"button",text:btnText,class:"btn "+btnClass,"data-dismiss":"modal","data-callback":item,"data-form":this.formid,click:function(e){var button=$(e.target);var callback=opts[button.attr("data-callback")];var form=button.attr("data-form");var array=$("#"+form).serializeArray();var keyval={};for(var i in array)keyval[array[i].name]=array[i].value;callback(keyval,array,e);}}).appendTo(footer);}modalWindow.modal();modalWindow.on('hide.bs.modal',function(e){opts.dismiss(e);});modalWindow.on('hidden.bs.modal',function(e){opts.complete(e);});}bootpopup.alert=function(message,title,callback){if(typeof title==="function")callback=title;if(typeof title!=="string")title=document.title;if(typeof callback!=="function")callback=function(){};bootpopup({title:title,content:[{p:{text:message}}],dismiss:function(){callback();}});}
bootpopup.confirm=function(message,title,callback){if(typeof title==="function")callback=title;if(typeof title!=="string")title=document.title;if(typeof callback!=="function")callback=function(){};var answer=false;bootpopup({title:title,showclose:false,content:[{p:{text:message}}],buttons:["no","yes"],yes:function(){answer=true;},dismiss:function(){callback(answer);}});}
bootpopup.prompt=function(label,type,message,title,callback){if(typeof type==="function")callback=type;if(typeof message==="function")callback=message;if(typeof title==="function")callback=title;if(typeof type!=="string")type="text";if(typeof message!=="string")message="Provide a "+type+" for:";if(typeof title!=="string")title=document.title;if(typeof callback!=="function")callback=function(){};bootpopup({title:title,content:[{p:{text:message}},{input:{type:type,name:"value",label:label}}],buttons:["cancel","ok"],ok:function(data){callback(data.value);}});}